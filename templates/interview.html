<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Tornado WebSocket Sample</title>
  <script src="//code.jquery.com/jquery-2.1.0.min.js"></script>
  <script src="http://localhost:8000/static/scripts/akobi_lib.js"></script>
</head>

<body>

  <script>
  var interviewID = window.location.pathname.split('/')[2];
  var webSocket = new WebSocket('ws://localhost:8888/i/' + interviewID + '/socket');
  var clientID = '';

  console.log("Starting up page.");

  webSocket.onmessage = function (evt) {
    console.log('Received from web socket: ' + evt.data);

    // TODO (Steve): Handle heartbeat response properly
    // not just static text
    type = JSON.parse(evt.data).type;

    if(type == 'heartbeat_response') {
      //do nothing for now
      return;
    }

    if (type == 'open_response') {

      clientID = JSON.parse(evt.data).clientID;

      console.log("Initializing interview.");
      initInterview(clientID, interviewID);

      console.log("Initializing heartbeat.");
      initHeartbeat(clientID, interviewID);

    } 

  };

  function initInterview(clientID, interviewID) {
    sendMessage('init_interview',
                clientID,
                interviewID,
                webSocket,
                {});
  }

  function initHeartbeat(clientID, interviewID) {
    setInterval(function() {
      sendMessage('heartbeat',
                  clientID,
                  interviewID,
                  webSocket,
                  {})}, 5000);
  }

  </script>
</body>
</html>

